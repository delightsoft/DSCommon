/*! DSCommon 0.1.0 */
(function(){var e;e=angular.module("docflow",["docflow.ui.client","docflow.ui.utils","docflow.config","ui.bootstrap.modal"]),e.run(["$docflow","$state","$rootScope",function(e,t,o){o.$docflow=e,o.$state=t}]),e.factory("$docflow",["$docflowClient","$docflowConfig","$docflowUtils","$state","$location","$modal","$window","$q","$log",function(e,t,o,i,n,r,l,c,a){var s;return s=null,{_setEditor:function(e){s=e},config:t,action:function(i,n,l){var s,u,d,f,p,m,g,h,w,v;if(w=o.splitFullId(i),p=t.docs[w.docType],!p)throw Error("$docflow.action: Id '"+i+"': Unknown type '"+w.docType+"'.");if(s=p.actions[n],!s)throw Error("$docflow.action: Name '"+n+"': No such action in type '"+w.docType+"'.");if(s.service){if(w.id)throw Error("$docflow.action: Action '"+w.docType+"."+n+"': Service action requires type instead of id '"+i+"'.")}else if(!w.id)throw Error("$docflow.action: Action '"+w.docType+"."+n+"': Non-service action requires id instead of type '"+i+"'.");if(l)for(m in l)switch(v=l[m],m){case"params":continue;case"doc":continue;case"r":continue;case"t":continue;case"tr":continue;default:a.error("$docflow.action: Unexpected parameter '"+m+"'.")}else l={};return u=c.defer(),d=function(t){var o;return o=c.defer(),e.action(i,n,t).then(function(e){o.resolve(e)},function(e){o.reject(e)},function(e){o.notify(e)}),o.promise},f=null,h=null,s.confirm&&(f=function(e,o){r.open({templateUrl:"/tmpl/"+t.templateBase+"/confirmation?"+t.tmplParams,backdrop:o?!1:"static",controller:["$scope",function(e){e.question=s.confirm,e.$on("$stateChangeStart",function(){f.close()})}]}).result.then(function(){d(e).then(function(e){u.resolve(e)},function(e){u.reject(e)},function(e){u.notify(e)})},function(){h||u.reject("Cancelled in confimation dialog")})}),s.params&&!l.params?(g=angular.copy(s.params),h=r.open({templateUrl:"/tmpl/doc/"+w.docType+"?b="+t.templateBase+"&t=params&a="+n+"&"+t.tmplParams,backdrop:"static",controller:["$scope",function(e){e.item=g,e.ok=function(){l||(l={}),l.params=o.buildDocumentUpdate(e.item),f?f(l,!0):d(l).then(function(e){u.resolve(e)},function(){})},e.$on("$stateChangeStart",function(){h.close()})}]}),u.promise.then(function(e){h.close(e)},function(e){h.close(e)})):f?f(l,!1):d(l).then(function(e){u.resolve(e)},function(e){u.reject(e)},function(e){u.notify(e)}),u.promise},openDoc:function(e,t){var r;if(r=o.splitFullId(e),!r.id)throw Error("Invalid id: "+fullId);i.transitionTo("doc."+r.docType+".form",{id:r.id}),(null!=t?t.replace:void 0)&&n.replace()},createDoc:function(e,t){var r;if(r=o.splitFullId(e),r.id)throw Error("Invalid type: "+fullId);i.transitionTo("doc."+r.docType+".create"),(null!=t?t.replace:void 0)&&n.replace()},hrefOpenDoc:function(e){var t;if(t=o.splitFullId(e),!t.id)throw Error("Invalid id: "+fullId);return i.href("doc."+t.docType+".form",{id:t.id})},hrefCreateDoc:function(e){var t;if(t=o.splitFullId(e),t.id)throw Error("Invalid type: "+fullId);return i.transitionTo("doc."+t.docType+".create")},openDocDialog:function(e,i){var n,l;if(l=o.splitFullId(e),!l.id)throw Error("Invalid id: "+fullId);return n=c.defer(),c.when(new s(e,i).loadOrCreate()).then(function(e){var o;o=r.open({templateUrl:"/tmpl/doc/"+l.docType+"?b="+t.templateBase+"&t=formDialog&"+t.tmplParams,backdrop:"static",controller:["$scope",function(i){i.itemHeaderUrl="/tmpl/doc/"+l.docType+"?b="+t.templateBase+"t=formTitle&"+t.tmplParams,i.editor=e,e.setEditorDialog(o),e.controller(i),i.$on("$stateChangeStart",function(){o.close()})}]}),o.result.then(function(e){n.resolve(e)})}),n.promise},createDocDialog:function(e,i){var n,l;if(l=o.splitFullId(e),l.id)throw Error("Invalid type: "+fullId);return n=c.defer(),c.when(new s(e,i).loadOrCreate()).then(function(e){var o;o=r.open({templateUrl:"/tmpl/doc/"+l.docType+"?b="+t.templateBase+"&t=formDialog&"+t.tmplParams,backdrop:"static",controller:["$scope",function(i){i.itemHeaderUrl="/tmpl/doc/"+l.docType+"?b="+t.templateBase+"&t=formTitle&"+t.tmplParams,i.editor=e,e.setEditorDialog(o),e.controller(i),i.$on("$stateChangeStart",function(){o.close()})}]}),o.result.then(function(e){n.resolve(e)})}),n.promise},navigateBack:function(){l.history.back()},switchDemoUser:function(e){var t;t=n.search(),angular.isDefined(e)?t.user=e:delete t.user,n.search(t),window.location.href=n.$$url}}}])}).call(this),function(){var e;e=angular.module("dscommon",["angularFileUpload","ui.router","ui.select2","docflow.misc.resizeItemContent","docflow.type.result","docflow.ui.actions","docflow.ui.client","docflow.ui.editor","docflow.ui.form","docflow.ui.httpListener","docflow.ui.states","docflow.ui.table","docflow.ui.tabLinkedDocument","docflow.ui.utils","docflow.widget.container","docflow.widget.datetime","docflow.widget.enum","docflow.widget.file","docflow.widget.id","docflow.widget.json","docflow.widget.password","docflow.widget.phone","docflow.widget.photoСontrol","docflow.widget.popover","docflow.widget.scrollspy","docflow.widget.select2","docflow.widget.selector","docflow.widget.state","docflow.widget.subtable","docflow.widget.tags","docflow.widget.textarea.size","docflow.widget.texteditor","docflow.appCommon","docflow.config","docflow"])}.call(this),function(){var e;e=angular.module("docflow.appCommon",["ui.router"]),e.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,o){o.html5Mode(!0)}]),e.run(["$state","$location","$rootScope","$anchorScroll",function(e,t,o,i){o.scrollTo=function(e,o){t.hash(e),i(),o&&(o.preventDefault(),o.stopPropagation())}}]),e.directive("docflowPageTitle",function(){return{restrict:"A",link:function(e,t,o){return o.$observe("pageTitle",function(t){e.setPageTitle(t||"")})}}}),e.constant("paginationConfig",{boundaryLinks:!1,directionLinks:!0,firstText:"<<",previousText:"<",nextText:">",lastText:">>"})}.call(this),function(){var e,t,o;e=angular.module("docflow.config",["docflow.ui.utils","ng"]),o=function(e,t,o){Object.defineProperty(e,t,{configurable:!1,get:o})},t=function(e,t,o,i){Object.defineProperty(e,t,{configurable:!0,get:function(){var n;return n=o(),Object.defineProperty(e,t,{configurable:!!i,value:n}),n}})},e.provider("$docflowConfig",["$docflowUtilsProvider","$windowProvider",function(e,i){var n,r;n=this,r="ngApp",this.changeTemplateBase=function(e){r=e},this.docflowConfig=i.$get().docflowConfig,t(this,"user",function(e){return function(){return e.docflowConfig.user}}(this)),t(this,"docs",function(t){return function(){var o,i,n,r,l,c;l=t.docflowConfig.docs;for(r in l){n=l[r],n._n&&e.processDocumentBeforeEditing(n._n),c=n.actions;for(i in c)o=c[i],o.params&&(o.params={_u:o.params})}return t.docflowConfig.docs}}(this)),t(this,"messages",function(e){return function(){return e.docflowConfig.messages||{}}}(this)),this.$get=["$location",function(e){return function(i){return t(e,"templateBase",function(){return r}),o(e,"debug",function(){return i.search().debug}),o(e,"user",function(){return i.search().user}),o(e,"tmplParams",function(){var e,t,o,n;return t=i.search(),o=[],(e=t.debug)&&o.push("debug="+e),(n=t.user)&&o.push("user="+n),o.join("&")}),o(e,"apiParams",function(){var e;return(e=i.search().user)?"user="+e:""}),e}}(this)]}]),e.run(["$docflowConfig","$rootScope","$location",function(e,t,o){var i;i={},e.debug&&(i.debug=e.debug),e.user&&(i.user=e.user),t.$on("$stateChangeSuccess",function(){o.search(angular.extend(o.search(),i)),o.replace()})}])}.call(this),function(){var e;e=angular.module("docflow.misc.resizeItemContent",[]),e.directive("docflowResizeItemContent",["$log",function(e){return{restrict:"A",scope:!1,replace:!1,transclude:!1,link:function(t,o,i){var n,r,l,c,a;i.docflowResizeItemContent&&(a=t.$eval(i.docflowResizeItemContent)),c={},angular.isObject(a)&&angular.extend(c,a),n=o.find(c.bottomClass)[0],n?(r=o.find(c.contentClass),l=function(){var e;e=n.getBoundingClientRect().top,r.each(function(){var t;return t=e-this.getBoundingClientRect().top-20,$(this).css({height:t})})},l(),$(window).resize(function(){l()})):e.warn("docflow/misc/resizeItemContent: Element with class "+c.bottomClass+" not found")}}}])}.call(this),function(){var e;e=angular.module("docflow.type.result",["ui.bootstrap.modal","template/modal/window.html","template/modal/backdrop.html"]),e.directive("dfTypeResult",["$modal",function(e){return{restrict:"C",scope:!0,require:"ngModel",link:function(t,o,i,n){t.showMessages=function(){e.open({windowClass:"df-area-result-popup",template:'<i class="fa fa-times" ng-click="$close()"></i>'+n.$viewValue.messages.html,backdrop:"static"})}}}}])}.call(this),function(){var e;e=angular.module("docflow.ui.actions",["docflow.config"]),e.constant("docflowActionInProgressShowAfterDelayTime",2e3),e.constant("docflowActionDoneHideDelayTime",3e3),e.directive("docflowActionsContainer",["$docflowActions","$compile","$animate",function(e,t,o){return{restrict:"A",scope:!0,controller:["$scope",function(){this.contentTransclude=null,this.contentElement=null}],link:function(i,n,r,l){var c,a,s,u;s=null,a=null,u=i.$eval(r.docflowActionsContainer),c={errorOnly:!!(null!=u?u.errorOnly:void 0),setAction:function(e){i.action=e}},e.add(c),i.$watch("action.message",function(e){s&&(o.leave(a),a=null,s.$destroy(),s=null),e&&(s=i.$new(),l.contentTransclude(s,function(i){a=i,a.html(e),t(a.contents())(s),o.enter(a,null,l.contentElement)}))}),i.$on("$destroy",function(){e.remove(c)})}}}]),e.directive("docflowActionsContainerContent",["$docflowActions","$compile",function(){return{restrict:"EA",require:"^docflowActionsContainer",transclude:"element",link:function(e,t,o,i,n){i.contentTransclude=n,i.contentElement=t}}}]),e.directive("docflowActionsAutohide",["$docflowActions","docflowActionDoneHideDelayTime","$timeout",function(e,t,o){return{restrict:"EA",scope:!0,link:function(e){e.action.showClose=!1,o(function(){var t;null!=(t=e.action)&&t.hide()},t)}}}]),e.factory("$docflowActions",["$docflowConfig","$docflowUtils","docflowActionInProgressShowAfterDelayTime","docflowActionDoneHideDelayTime","$rootScope","$timeout",function(e,t,o,i,n,r){var l,c,a,s,u,d;return a=null,s=null,c=[],d=function(e){var t,o,i,n;if(a!==e&&s&&(s.setAction(null),s=null),a=e,c.length>0){if(o=c[0],"failed"!==e.state)for(i=0,n=c.length;n>i;i++)if(t=c[i],!t.errorOnly){o=t;break}s!==o&&(s&&s.setAction(null),(s=o).setAction(e))}},u=0,{containers:c,Action:l=function(){function n(){return l.apply(this,arguments)}var l;return l=function(n,l,c){var a,s,u,d,f,p,m,g;if(!n)throw Error("id argument is missing");if(!l)throw Error("name argument is missing");if(!c)throw Error("promise argument is missing");u=t.splitFullId(n),d=null!=(f=e.docs[u.docType])&&null!=(p=f.actions)&&null!=(m=p[l])?m.title:void 0,d||(d=l),s=null!=(g=e.messages.actionProgress)?g.replace("{{title}}",d):void 0,this.name=l,this.title=d||l,this.state="progress",this.message=null,this.promise=c,this.showClose=!1,s&&(this.forceShowMessage=a=function(e){return function(){"progress"===e.state&&(e.message=s)}}(this),r(a,o)),c.then(function(t){return function(o){var n;t.state="done","list"===t.name?t.message=o:o?(t.showClose=!0,t.message=o):(r(function(){t.hide()},i),t.message=null!=(n=e.messages.actionDone)?n.replace("{{title}}",t.title):void 0)}}(this),function(t){return function(o){var i;t.state="failed",t.showClose=!0,t.message=t.message=o?o:null!=(i=e.messages.actionFailed)?i.replace("{{title}}",t.title):void 0}}(this))},n.prototype.hide=function(){a===this&&null!=s&&s.setAction(null)},n}(),setPreserveActionResultOverUIStateTransition:function(){u=4},add:function(e){c.unshift(e),a&&s&&(s.setAction(null),s=null),u>0&&a&&0===--u&&(s=e,e.setAction(a))},remove:function(e){var t;(t=c.indexOf(e))>=0&&(c.splice(t,1),s===e&&(s=null,"failed"!==a.state&&d(a)))},send:function(e){d(e),e.promise.then(function(){return d(e)},function(){return d(e)})}}}])}.call(this),function(){var e;e=angular.module("docflow.ui.client",["docflow.config","docflow.ui.utils","docflow.ui.httpListener","docflow.ui.actions"]),e.factory("$docflowClient",["$docflowActions","$docflowUtils","$docflowConfig","$http","$rootScope","$document","$q",function(e,t,o,i,n,r,l){var c,a,s;return a=null,c=null,s=null,{list:function(){},get:function(e,t){var n,r,a,s,u,d,f;if((null!=c?c.id:void 0)===e)return f=[c,null],s=f[0],c=f[1],n=l.defer(),n.resolve(s),n.promise;if(c=null,a=[],t)for(r in t)d=t[r],angular.isDefined(d)&&a.push(""+r+"="+d);return u="/api/get/"+e+"?"+a.join("&")+"&"+o.apiParams,i({method:"GET",url:u}).then(function(e){return e.data},function(t){throw Error("Failed to get document with id '"+e+"' (Code: "+t.status+")")})},action:function(n,r,s){var u,d,f,p,m,g,h,w,v,y;if(p=o.docs[t.docType(n)],!p)throw Error("Doctype "+t.docType(n)+" not in docflowConfig");if(u=null!=(y=p.actions)?y[r]:void 0,!u)throw Error("Doctype "+t.docType(n)+" has no action "+r+" in docflowConfig");if(a)return"function"==typeof a.forceShowMessage&&a.forceShowMessage(),l.reject("Another action is currenly running",a);g=[];for(m in s)v=s[m],"params"!==m&&"doc"!==m&&"message"!==m&&angular.isDefined(v)&&g.push(""+m+"="+v);return w="/api/action/"+n+"/"+r+"?"+g.join("&")+"&"+o.apiParams,s?(d={},s.params&&(d.params=s.params),s.doc&&(d.doc=s.doc),h=!angular.isDefined(s.message)||s.message):h=!0,h&&(f=l.defer(),e.send(a=new e.Action(n,r,f.promise))),i({method:"POST",url:w,data:d}).then(function(e){return d=e.data,"Ok"===d.code?("create"===r&&(c=d.doc),d.file&&$("<iframe>").hide().prop("src","/api/download/"+d.file).appendTo("body"),f&&(f.resolve(d.message),a=null),d):(f&&(f.reject(d.message),a=null),l.reject(e))},function(){f&&(f.reject(),a=null)})}}}])}.call(this),function(){var e,t=[].slice,o={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=angular.module("docflow.ui.editor",["docflow","docflow.ui.client","docflow.config","docflow.ui.utils"]),e.run(["$docflow","$docflowEditor",function(e,t){e._setEditor(t)}]),e.provider("$docflowEditor",["$docflowUtilsProvider","$docflowConfigProvider","$injector",function(e,o){var n,r;r={},n=[],this.registerTabTemplate=function(e,t){r[e]=t},this.registerTabScopeExtention=function(e){n.push(e)},this.$get=["$docflow","$docflowActions","$docflowClient","$docflowUtils","$docflowConfig","$q",function(l,c,a,s,u,d){var f,p,m;return this.Tab=m=function(){function e(){return i.apply(this,arguments)}var i;return i=function(e,t,i){this.editor=e,this.name=t,this.scope=null,this.removeWatcher=null,this.visible=!0,this.config=i,i&&(this.docType=i.doc,this.template=i.template,this.angularTmpl="/tmpl/doc/"+this.docType+"?b="+u.templateBase+"&t="+this.template+"&item="+e.docType+"&tab="+t+"&"+o.tmplParams)},e.prototype.name=null,e.prototype.controller=["$scope",function(e){(function(){var t,o,i;for(this.scope=e,e.$on("$destroy",function(e){return function(){e.scope=e.removeWatcher=null}}(this)),this.item&&(e.item=this.item,this.setWatcher()),o=0,i=n.length;i>o;o++)t=n[o],t()(e,this)}).call(e.$parent.tab)}],e.prototype.setWatcher=function(){!this.modified&&this.scope&&this.item&&("function"==typeof this.removeWatcher&&this.removeWatcher(),this.removeWatcher=this.scope.$watch("item",function(e){return function(t,o){t!==o&&(e.modified=!0,e.removeWatcher(),e.removeWatcher=null)}}(this),!0))},e.prototype.splitDoc=function(e){var t,o,i,n,r,l,c,a,u,d;if(this.config.fields){for(this.item=i={},u=this.config.fields,r=0,c=u.length;c>r;r++)o=u[r],e.hasOwnProperty(o)&&(i[o]=e[o],delete e[o]);if(e._u)for(t=e._u,i._u=n={},d=this.config.fields,l=0,a=d.length;a>l;l++)o=d[l],t.hasOwnProperty(o)&&(n[o]=t[o],delete t[o]);s.processDocumentBeforeEditing(i)}},e.prototype.mergeDoc=function(e){this.config.fields&&angular.extend(e,s.buildDocumentUpdate(this.item))},e.prototype._modified=!1,Object.defineProperty(e.prototype,"modified",{get:function(){return this._modified},set:function(e){this._modified=e,e&&(this.editor.modified=!0)}}),e.prototype._isNew=void 0,Object.defineProperty(e.prototype,"isNew",{get:function(){return angular.isDefined(this._isNew)?this._isNew:this.editor.isNew},set:function(e){this._isNew=e}}),e.prototype.action=function(e,t){if(!this.item)throw Error("Cannot call action(...) for tab that doesn't have .item");return l.action(this.item.id,e,{params:t,r:this.item.rev,t:this.template})},e.prototype.callParent=function(){var e,o;return o=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],this.__proto__.__proto__[o].apply(this,e)},e}(),p=function(t){function o(){return n.apply(this,arguments)}var n;return i(o,t),n=function(e){m.call(this,e,"_main"),this.item=null,this.docType=e.docType,this.template=e.template,this.angularTmpl="/tmpl/doc/"+this.docType+"?b="+u.templateBase+"&t=mainTab",this.editorDlg=null},o.prototype.splitDoc=function(t){this.visible=!0,this.item=e.updateModel(this.item,t),e.processDocumentBeforeEditing(this.item),this.scope&&(this.scope.item=this.item)},o.prototype.mergeDoc=function(e){angular.extend(e,s.buildDocumentUpdate(this.item))},o.prototype.action=function(e,t){this.callParent("action",e,t).then(function(e){return function(t){e.editor.setDoc(t.doc)}}(this))},o}(m),f=function(){function t(){return o.apply(this,arguments)}var o;return o=function(t,o){var i,n,l,c,a,s,d,f,g,h,w,v;if(this.docId=t,this.isNew=e.isNewDoc(t),this.docType=n=e.docType(t),this.template=d="form",o&&(o.t&&(this.template=d=o.t),this.resultTemplate=o.resultTemplate?o.resultTemplate:d),this.docConfig=i=u.docs[n],this.modified=!1,this.upload=0,!i)throw Error("Doctype "+n+" not in docflowConfig");if(this.templateConfig=f=null!=(w=i.templates)?w[d]:void 0,!f)throw Error("Doctype "+n+" has no template "+this.template+" in docflowConfig");if(l=new p(this),this.tabs=s={},this.selectedTab=s[l.name]=l,f.tabs){v=f.tabs;for(a in v)c=v[a],g="function"==typeof r[h=c.template]?r[h]():void 0,s[a]=g?new g(this,a,c):new m(this,a,c)}},t.Tab=m,t.prototype.scope=null,t.prototype.controller=function(e){this.scope=e,e.doc=this.doc,e.tab=this.selectedTab,e.$on("$destroy",function(e){return function(){e.scope=null}}(this))},t.prototype.setDoc=function(e){var t,o,i,n,r,l;if(e){this.doc=e,t=angular.copy(e),o=this.tabs._main,r=this.tabs;for(n in r)i=r[n],i!==o&&i.splitDoc(t);o.splitDoc(t),this.scope&&(this.scope.doc=e),this.selectedTab.visible||this.selectTab("_main")}this.modified=!1,l=this.tabs;for(n in l)i=l[n],i.modified=!1,i.setWatcher()},t.prototype.loadOrCreate=function(){var e;if(this.isNew&&!this.docConfig.newInstance){if(!this.docConfig._n)throw Error("Missing _n for type '"+this.docType+"' in docflowConfig");return this.setDoc(this.docConfig._n),this.modified=!0,this}return e=d.defer(),(this.isNew?a.action(this.docType,"newInstance",{t:"form"}).then(function(e){return e.result}):a.get(this.docId,{t:"form"})).then(function(t){return function(o){t.setDoc(o),e.resolve(t)}}(this)),e.promise},t.prototype.selectTab=function(e,t){var o;if(o=this.tabs[e],!o){if(t)return;throw Error("Tab with name "+e+" not found")}if(!o.visible){if(t)return;throw Error("Tab "+e+" is not visible")}this.selectedTab=o,this.scope&&(this.scope.tab=o)},t.prototype.extendScope=function(e){return e.editor=editor},t.prototype.setEditorDialog=function(e){this.editorDlg=e},t.prototype.save=function(){var e,t,o,i;if(this.modified){e={},i=this.tabs;for(o in i)t=i[o],t.modified&&t.mergeDoc(e);return a.action(this.doc.id,this.isNew?"create":"update",{doc:e,r:this.doc.rev,t:"form",ot:this.resultTemplate?this.resultTemplate:"form"}).then(function(e){return function(t){e.editorDlg?e.editorDlg.close(t.doc):e.isNew?(c.setPreserveActionResultOverUIStateTransition(),l.openDoc(t.doc.id,{replace:!0})):e.setDoc(t.doc)}}(this))}},t.prototype.cancel=function(){this.editorDlg?this.editorDlg.dismiss():this.isNew?l.navigateBack():this.setDoc(this.doc)},t}()}]}])}.call(this),function(){var e;e=angular.module("docflow.ui.form",[]),e.directive("docflowForm",[function(){return{restrict:"A",scope:!1,link:function(e){var t;e.v=function(e,o){return(null!=o?o.hasOwnProperty(e):void 0)&&!t(e,o)},e.u=t=function(e,t){var o;return null!=t&&null!=(o=t._u)?o.hasOwnProperty(e):void 0},e.vu=function(e,t){var o;return(null!=t?t.hasOwnProperty(e):void 0)||(null!=(o=t._u)?o.hasOwnProperty(e):void 0)},e.fv=function(e,t){var o,i;if(e&&t)for(o in t._u)if(null!=(i=e[o])?i.$invalid:void 0)return!1;return!0}}}}])}.call(this),function(){var e;e=angular.module("docflow.ui.httpListener",["docflow.config"]),e.config(["$httpProvider",function(e){e.responseInterceptors.push("appHttpListener")}]),e.factory("appHttpListener",["$q","$log","$location","$docflowConfig",function(e,t,o,i){return function(o){return o.then(function(e){return e},function(o){return 401===o.status?("function"==typeof i.goToLogin&&i.goToLogin(),e.reject(o)):(t.error(o),e.reject(o))})}}])}.call(this),function(){var e,t;t=angular.module("docflow.ui.states",["ui.router.state","docflow.config"]),t.config(["$stateProvider","$docflowConfigProvider",function(t,o){var i,n,r,l;t.state({name:"doc",url:"/doc",templateUrl:function(){return"/tmpl/"+o.templateBase+"/doc/docIndex?"+o.tmplParams}}),l=o.docs,r=function(){return function(i){var n,r;t.state({name:"doc."+i}),t.state({url:"/"+i,name:"doc."+i+".list",views:{"@doc":{templateUrl:function(){return"/tmpl/doc/"+i+"?b="+o.templateBase+"&t=list&"+o.tmplParams},controller:["$scope",function(e){e.values={}}]}}}),n=["$scope","editor","$docflowClient",function(e,t){e.itemHeaderUrl="/tmpl/doc/"+i+"?b="+o.templateBase+"&t=formTitle&"+o.tmplParams,e.editor=t,t.controller(e)}],t.state({name:"doc."+i+".create",url:"/"+i+"/new",resolve:{editor:["$docflowEditor","$stateParams","$location","$log",function(t,o,n,r){var l;try{return e(new t(""+i),n,r).loadOrCreate()}catch(c){throw l=c,r.error(l),l}}]},views:{"@doc":{templateUrl:function(){return"/tmpl/doc/"+i+"?b="+o.templateBase+"&t=form&"+o.tmplParams},controller:n}}}),t.state({name:"doc."+i+".form",url:"/"+i+"/{id}",resolve:{editor:["$docflowEditor","$stateParams","$location","$log",function(t,o,n,r){var l;try{return e(new t(""+i+"@"+o.id),n,r).loadOrCreate()}catch(c){throw l=c,r.error(l),l}}]},views:{"@doc":{templateUrl:function(){return"/tmpl/doc/"+i+"?b="+o.templateBase+"&t=form&"+o.tmplParams},controller:n}}}),r=t.state({name:"doc."+i+".form.comments",url:"/comments"}),r["@doc."+i+".form"]={templateUrl:function(){return"/tmpl/comments/itemComments?b="+o.templateBase+"&"+o.tmplParams}}}}(this);for(n in l)i=l[n],r(n)}]),e=function(e,t){var o,i;return o=e.controller,e.controller=function(i){e.selectTab(t.search().tab,!0),o.call(e,i)},i=e.selectTab,e.selectTab=function(o,n){var r,l,c;c=t.search(),l=c.tab,i.call(e,o,n),r=e.selectedTab.name,("_main"===r&&angular.isDefined(l)||r!==l)&&("_main"===r?delete c.tab:c.tab=r,t.search(c),t.replace())},e}}.call(this),function(){var e,t,o={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};t=angular.module("docflow.ui.tabLinkedDocument",["docflow.config","docflow.ui.editor","docflow.ui.utils"]),e=null,t.config(["$docflowEditorProvider",function(t){t.registerTabTemplate("linkedDocument",function(){return e})}]),t.run(["$docflowEditor","$docflowUtils","$docflowConfig",function(t,o,n){e=function(e){function r(){return l.apply(this,arguments)}var l;return i(r,e),l=function(e,o,i){t.Tab.call(this,e,o,i),this.template="form"},r.prototype.splitDoc=function(e){var t,i,r,l;if(this.visible=!0,this.isNew=!1,this.id=e.id,(this.canCreate=t=angular.isDefined(null!=(r=e._u)?r[this.name]:void 0))?(this.item=e._u[this.name],delete e._u[this.name]):this.item=e[this.name],angular.isObject(this.item))o.processDocumentBeforeEditing(this.item);else if(t){if(this.docConfig=i=n.docs[this.docType],!i)throw Error("DocType "+this.docType+" not in docflowConfig");if(!i._n)throw Error("Missing _n for type '"+this.docType+"' in docflowConfig");(null!=(l=this.config.options)?l.showNew:void 0)?(this.item=angular.copy(i._n),this.isNew=!0):this.visible=!1}else this.visible=!1;delete e[this.name],this.scope&&(this.scope.item=this.item)},r.prototype.mergeDoc=function(e){var t,i;e[this.name]=t=o.buildDocumentUpdate(this.item),i=o.splitFullId(this.id),i.id&&(t.subj=this.id)},r.prototype.action=function(e,t){this.callParent("action",e,t).then(function(e){return function(t){var o,i;o=t.doc.subj,angular.isDefined(null!=(i=o._u)?i[e.name]:void 0)?o._u[e.name]&&(o._u[e.name]=t.doc):o[e.name]&&(o[e.name]=t.doc),delete t.doc.subj,e.editor.setDoc(o)}}(this))},r.prototype.createLinkedDoc=function(){if(this.item)throw Error("Cannot create linked document: Field "+this.name+" already not null.");if(!this.canCreate)throw Error("Cannot create linked document: User has no right to modify field "+this.name+".");this.item=angular.copy(this.docConfig._n),this.isNew=!0,this.visible=!0,this.modified=!0,this.editor.selectTab(this.name)},r}(t.Tab)}])}.call(this),function(){var e,t,o,i;o=angular.module("docflow.ui.table",["ui.bootstrap.pagination","docflow.ui.actions","docflow.ui.utils"]),o.constant("docflowPagingSize",7),t=function(e,t){var o,i,n;i={};for(o in e)n=e[o],o.substring(0,t.length)===t&&(i[o.substring(t.length)]=decodeURI(n));return i},i=function(e,t,o,i){var n,r,l;for(n in o)l=o[n],"c"!==n&&(r=i+n,angular.isObject(l)?t[r]=l.id:!l||"p"===n&&1===l?delete t[r]:t[r]=l);return t},e=function(e,t,o,i,n,r,l,c,a,s,u){var d,f,p,m,g,h,w;d=new Array;for(g in a)w=a[g],angular.isDefined(w)&&d.push(""+g+"="+i.encodeUriQuery(w,!0));for(m in s)"c"===m||(null!=a?a.hasOwnProperty(m):0)||(w=u&&u.hasOwnProperty(m)?u[m]:s[m],angular.isDefined(w)&&null!==w&&d.push(angular.isObject(w)?""+m+"="+i.encodeUriQuery(w.id,!0):""+m+"="+i.encodeUriQuery(w,!0)));return h=(null!=u?u.p:void 0)||s.p||1,h>=0&&(f=h+Math.round(c/2),c>=f&&(f=c+1),d.push("c="+f)),o&&(p=r.defer(),o.send(new o.Action(l,"list",p.promise))),t({method:"GET",url:"/api/list/"+l+"?"+d.join("&")+"&"+n.apiParams}).then(function(e){return p&&(e.data.hasOwnProperty("code")&&"Ok"!==e.data.code?p.reject(e.data.message):p.resolve(e.data.message)),i.processDocumentsListBeforeEditing(e.data.list),e.data})},o.directive("docflowTable",["$http","$docflowActions","$docflowUtils","$docflowConfig","$q","$location","docflowPagingSize","$log",function(o,n,r,l,c,a,s,u){return{restrict:"E",replace:!1,transclude:!0,scope:!0,controller:["$scope","$attrs",function(e,o){e.urlPrefix=o.urlPrefix,e.query=e.urlPrefix?t(a.search(),e.urlPrefix):a.search(),e.docType=o.docType,e.pagingSize=o.pagingSize||s,e.params={},e.ctrlValues={},e.values={},e.items=null,e.$watch("query",function(t,o){t!==o&&angular.copy(t,e.values)},!0)}],link:function(t,s,d,f,p){var m;if(p||u.error("Missing transclution content"),d.data){if(m=t.$eval(d.data),!angular.isObject(m))throw new Error("Invalid docflow-table data: #{attrs.data}");angular.extend(t,m),d.onLoad&&t.$eval(d.onLoad,{list:t.list})}else if(d.params){if(m=t.$eval(d.params),!angular.isObject(m))throw new Error("Invalid docflow-table params: #{attrs.params}");t.params=m,t.$evalAsync("update()")}else t.$evalAsync("update()");t.update=function(s){e(t,o,t.urlPrefix?null:n,r,l,c,t.docType,t.pagingSize,t.params,t.query,s).then(function(e){var o,n;return t.query=n=e.query,t.list=o=e.list,t.items=n.p===n.c?(n.p-1)*n.s+(null!=o?o.length:void 0):null,d.onLoad&&t.$eval(d.onLoad,{list:t.list}),a.search(i(r,a.search(),t.query,t.urlPrefix)),a.replace()})},t.onSelectPage=function(e){t.update(e===t.query.c?{p:-1}:{p:e})},p(t,function(e){return s.empty(),s.append(e)})}}}])}.call(this),function(){var e;e=angular.module("docflow.ui.utils",[]),e.provider("$docflowUtils",[function(){var e,t,o,i,n,r;r=this,this.$get=function(){return r},r.docType=function(e){var t;return t=e.indexOf("@"),t>0?e.substr(0,t):e},r.splitFullId=function(e){var t;return t=e.indexOf("@"),t>0?{docType:e.substr(0,t),id:e.substr(t+1)}:{docType:e}},r.isNewDoc=function(e){var t;return t=e.indexOf("@"),-1===t},r.processDocumentsListBeforeEditing=i=function(e,t){var i,n,r,l;if(t=angular.isDefined(t)?t+1:0,e)for(i=0,r=0,l=e.length;l>r;r++)n=e[r],o(n,t),t>0&&(n.i=i++)},r.processDocumentBeforeEditing=o=function(e,t){var n,r,l;if(null!=e?e._u:void 0){t=angular.isDefined(t)?t+1:0,l=e._u;for(n in l)r=l[n],angular.isArray(r)?(i(r,t),e[n]=r):angular.isObject(r)&&(o(r,t),e[n]=r)}},r.buildDocumentsListUpdate=t=function(t){var o;return function(){var i,n,r;for(r=[],i=0,n=t.length;n>i;i++)o=t[i],r.push(e(o));return r}()},r.buildDocumentUpdate=e=function(o){var i,n;if(!(null!=o?o._u:void 0))return o.id?o.id:{};for(i in o)n=o[i],"_u"!==i&&o._u.hasOwnProperty(i)&&(angular.isArray(n)?o._u[i]=t(n):angular.isObject(n)?o._u[i]=e(n):angular.isObject(o._u[i])&&(o._u[i]=null));return angular.isDefined(o.i)?o._u.i=o.i:angular.isDefined(o.id)&&(o._u.id=o.id,angular.isDefined(o.rev)&&(o._u.rev=o.rev)),o._u},r.encodeUriQuery=function(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")},r.updateModel=n=function(e,t){var o,i,r,l,c,a,s,u,d,f;if(!e)return t;for(r in e)if(a=e[r],"$"!==r.substr(0,1));else if(t.hasOwnProperty(r))if(angular.isArray(a)){for(o=t[r],i=s=0,d=o.length;d>s;i=++s)for(c=o[i],u=0,f=a.length;f>u;u++)l=a[u],l.id===c.id&&(n(l,c),o[i]=l);angular.copy(o,a)}else angular.isObject(a)?n(a,t[r]):e[r]=t[r];else delete e[r];return angular.extend(e,t),e}}]),e.run(["$rootScope","$docflowConfig","$state","$location","$sce",function(e,t,o,i,n){e.$angular=angular,e.$sce=n,e.pageTitle="",e.setPageTitle=function(t){var i;e.pageTitle=t,null!=(i=o.current)&&(i.pageTitle=t)}}])}.call(this),function(){var e;e=angular.module("docflow.widget.container",[]),e.directive("docflowContainer",["$animate",function(e){var t;return t=null,{restrict:"A",controller:["$scope",function(){this.count=0,t=this}],link:function(o,i){return t.item=function(t){var o;o=!!this.count,t?this.count++:this.count--,o!==!!this.count&&e[o?"addClass":"removeClass"](i,"ng-hide")},e.addClass(i,"ng-hide")}}}]),e.directive("docflowContainerItemShow",["$animate",function(e){return{restrict:"A",require:"^docflowContainer",link:function(t,o,i,n){t.$watch(i.docflowContainerItemShow,function(t,i){t===i?t&&n.item(t):n.item(t),e[t?"removeClass":"addClass"](o,"ng-hide")})}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.datetime",["docflow.config"]),$.datepicker.regional.ru={closeText:"Закрыть",prevText:"<Пред",nextText:"След>",currentText:"Сегодня",monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesShort:["вск","пнд","втр","срд","чтв","птн","сбт"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Не",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},$.datepicker.setDefaults($.datepicker.regional.ru),$.timepicker.regional.ru={timeOnlyTitle:"Выберите время",timeText:"Время",hourText:"Часы",minuteText:"Минуты",secondText:"Секунды",millisecText:"Миллисекунды",timezoneText:"Часовой пояс",currentText:"Сейчас",closeText:"Закрыть",timeFormat:"HH:mm",amNames:["AM","A"],pmNames:["PM","P"],isRTL:!1},$.timepicker.setDefaults($.timepicker.regional.ru),e.directive("docflowWidgetDate",["$rootScope","$timeout",function(e,t){return{restrict:"EA",require:"ngModel",link:function(o,i,n,r){var l,c,a;c={},angular.isObject(a=o.$eval(n.docflowWidgetDate))&&angular.extend(c,a),l=$("input",i),t(function(){l.datepicker(c,$.datepicker.regional.ru),l.change(function(){var t;t=l.datetimepicker("getDate"),r.$setViewValue(t?t.getTime()-6e4*t.getTimezoneOffset():null),e.$digest()}),(r.$render=function(){l.datetimepicker("getDate")!==r.$viewValue&&l.datetimepicker("setDate",r.$viewValue?new Date(r.$viewValue+6e4*(new Date).getTimezoneOffset()):null)})()},0)}}}]),e.directive("docflowWidgetTime",["$rootScope",function(e){return{restrict:"EA",require:"ngModel",link:function(t,o,i,n){var r,l,c;l={},angular.isObject(c=t.$eval(i.docflowWidgetTime))&&angular.extend(l,c),r=$("input",o),$timeout(function(){r.timepicker($.datepicker.regional.ru),r.change(function(){var t;
t=r.datetimepicker("getDate"),n.$setViewValue(t?t.getTime()-6e4*t.getTimezoneOffset():null),e.$digest()}),(n.$render=function(){r.datetimepicker("getDate")!==n.$viewValue&&r.datetimepicker("setDate",n.$viewValue?new Date(n.$viewValue+6e4*(new Date).getTimezoneOffset()):null)})()},0)}}}]),e.directive("docflowWidgetDateTime",["$rootScope",function(e){return{restrict:"EA",require:"ngModel",link:function(t,o,i,n){var r,l,c;l={},angular.isObject(c=t.$eval(i.docflowWidgetDateTime))&&angular.extend(l,c),r=$("input",o),$timeout(function(){r.datetimepicker($.datepicker.regional.ru),r.change(function(){var t;t=r.datetimepicker("getDate"),n.$setViewValue(t?t.getTime()-(l.local?6e4*t.getTimezoneOffset():0):null),e.$digest()}),(n.$render=function(){r.datetimepicker("getDate")!==n.$viewValue&&r.datetimepicker("setDate",n.$viewValue?new Date(n.$viewValue+(l.local?6e4*(new Date).getTimezoneOffset():0)):null)})()},0)}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.enum",[]),e.directive("docflowEnum",[function(){return{restrict:"A",require:"ngModel",scope:!0,link:function(e,t,o,i){var n;n=e.$eval(o.docflowEnum),i.$render=function(){var o;e.prevVal&&(e.prevVal.color&&t.removeClass("df-enum-"+e.prevVal.color),e["enum"]=null),i.$viewValue?(e.prevVal=o=n[i.$viewValue],angular.isDefined(o)?(t.text(o.title),o.color&&t.addClass("df-enum-"+o.color)):t.text(i.$viewValue)):t.text("")}}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.file",["angularFileUpload","docflow.config"]),e.directive("docflowWidgetFile",["$fileUploader","$timeout","$rootScope","$log",function(e,t,o){return{restrict:"A",require:"ngModel",scope:!0,link:function(i,n,r,l){var c,a,s;a={scope:i,removeAfterUpload:!0},angular.isObject(s=i.$eval(r.docflowWidgetFile))&&angular.extend(a,s),c=$('input[type="file"]',n),i.uploader=e.create(a),i.progress=null,i.selectFile=function(){setTimeout(function(){c.click()},0)},i.clearFile=function(){l.$setViewValue(null)},i.uploader.bind("progress",function(e,t){i.progress=""+t.progress+"%",o.$digest()}),i.uploader.bind("success",function(){i.progress="100%",t(function(){i.editor&&i.editor.upload--,i.progress=null},1500),o.$digest()}),i.uploader.bind("error",function(){i.progress="0%",t(function(){i.editor&&i.editor.upload--,i.progress=null},1500),o.$digest()}),i.uploader.bind("complete",function(e,t,i,n){"Ok"===n.code&&(l.$setViewValue(n.result),o.$digest())}),i.uploader.bind("afteraddingfile",function(e,t){l.$setViewValue({id:null,text:t.file.name,blocked:!1}),i.progress="0%",i.editor&&i.editor.upload++,o.$digest(),i.uploader.uploadAll()})}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.id",[]),e.directive("docflowIdScope",[function(){return{restrict:"A",scope:!0,controller:["$scope",function(e){this.scope=e}]}}]),e.directive("docflowId",[function(){return{restrict:"A",require:"^?docflowIdScope",link:function(e,t,o,i){if(o.id)throw new Error("Element already has 'id' attribute");i&&$(t).attr("id",o.docflowId?""+o.docflowId+"-"+i.scope.$id:i.scope.$id)}}}]),e.directive("docflowFor",[function(){return{restrict:"A",require:"^?docflowIdScope",link:function(e,t,o,i){if(o["for"])throw new Error("Element already has 'for' attribute");i&&$(t).attr("for",o.docflowFor?""+o.docflowFor+"-"+i.scope.$id:i.scope.$id)}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.json",[]),e.directive("dfWidgetJson",["$modal",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,i){i.$formatters(push(function(e){return JSON.stringify(e,void 0,"  ")})),i.$parsers.push(function(e){return JSON.parse(e)})}}}]),e.directive("dfWidgetJsonView",["$modal",function(){return{restrict:"A",scope:!0,require:"ngModel",link:function(e,t,o,i){i.$render=function(){t.text(JSON.stringify(i.$viewValue,void 0,"  "))}}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.password",["docflow.config"]),e.directive("docflowWidgetPassword",[function(){return{restrict:"A",scope:!0,require:"ngModel",link:function(e,t,o,i){e.mode="changeButton",e.changePassword=function(){var t;e.mode="passwordFields",i.$render=function(){e.pwd1="",e.pwd2="",e.mode="changeButton"},e.pwd1="",e.pwd2="",t=function(){var t,o;t=e.pwd1.trim(),o=e.pwd2.trim(),i.$setViewValue(t===o&&""!==t?t:null)},e.$watch("pwd1",t),e.$watch("pwd2",t)}}}}]),e.directive("docflowWidgetPasswordMatch",[function(){return{restrict:"A",scope:!1,require:"ngModel",link:function(e,t,o,i){i.$parsers.push(function(t){return i.$setValidity("passwordMatch",t.trim()===e.pwd1.trim()),t})}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.phone",["docflow.config"]),e.filter("phone",function(){return function(e){var t,o,i;return o=e||"",angular.isArray(o)?void 0:(i=o.trim().replace(/[-\s\(\)]/g,""),t=function(e){var t,o,i;return o=""+e.slice(0,2),t="("+e.slice(2,5)+")",i=""+e.slice(5,8)+"-"+e.slice(8),e=""+o+" "+t+" "+i},12===i.length&&""+i.slice(0,2)=="+7"?t(i):o)}})}.call(this),function(){var e;e=angular.module("docflow.widget.photoСontrol",["docflow.config","ui.bootstrap.modal"]),e.directive("docflowWidgetPhotoControl",["$docflowUtils","$modal","$http",function(e,t,o){return{restrict:"A",require:"ngModel",link:function(e,i,n,r){e.changePhoto=function(){var i;i=t.open({templateUrl:"/tmpl/ngApp/modal/form-photo-control",backdrop:"static",controller:["$scope",function(t){t.item={url:r.$viewValue},t.ok=function(){i.close(t.item.url)},t.cancel=function(){i.dismiss("cancel")},t.upload=function(t){var n,r;n=new FormData(this),n.append("file",t[0]),n.append("id",e.editor.docId),r="/uploadImage",o.post(r,n,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(e){return i.close(e.filelink)}).error(function(){return console.error("Upload fail")})}}]}),i.result.then(function(e){r.$setViewValue(e)})}}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.popover",["docflow.config"]),e.directive("docflowWidgetPopover",[function(){return{link:function(e,t,o){var i,n,r,l;o.docflowWidgetPopover&&(l=e.$eval(o.docflowWidgetPopover)),n=t.children()[0],r={title:"...",placement:"right",trigger:"click"},angular.isObject(l)&&angular.extend(r,l),r.template="next"===r.content?t.next()[0]:t.children()[0],$(r.template).find("[docflow-widget-popover-close]").click(function(){t.tooltip("hide")}),i="click"===r.trigger,i&&(r.trigger="manual",t.click(function(){return t.tooltip("toggle"),!1})),t.tooltip(r)}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.scrollspy",["docflow.config"]),e.directive("docflowWidgetScrollspy",["$timeout","$window",function(e){return{restrict:"A",link:function(t,o,i){var n;n=i.docflowWidgetScrollspy?t.$eval(i.docflowWidgetScrollspy):{},e(function(){return o.scrollspy(n)})}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.select2",["docflow.config"]),e.directive("docflowFixSelect2",[function(){return{require:"ngModel",link:function(e,t,o,i){i.$parsers.unshift(function(e){var t,o,i,n;if(!(angular.isArray(e)&&e.length>0))return null;for(t={},i=0,n=e.length;n>i;i++)o=e[i],t[o]=!0;return t}),i.$formatters.unshift(function(e){var t,o,i;if(!angular.isObject(e))return[];o=[];for(t in e)i=e[t],i&&o.push(t);return o})}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.selector",["docflow.config","docflow.widget.select2"]),e.directive("docflowWidgetSelector",["$docflow","$docflowConfig","$http","$timeout","$log",function(e,t,o,i,n){var r;return r="Position",{scope:!0,restrict:"A",require:"ngModel",link:function(o,r,l,c){var a,s,u,d,f,p;return d={},l.docflowWidgetSelector&&angular.extend(d,o.$eval(l.docflowWidgetSelector)),d.docType?d.template?(o.createNew=function(){e.createDocDialog(d.docType,{resultTemplate:"dict"}).then(function(e){e&&(c.$setViewValue(e),c.$render())})},a=r.find("[docflow-select2]"),s=a.length>0?$(a[0]):r,p="/api/list/"+d.docType+"?"+t.apiParams,angular.isDefined(d.filter)&&d.filter.length>0&&(p="/api/list/"+d.docType+"?"+t.apiParams+("&"+d.filter)),u={cache:!1,url:p,dateType:"json",quiteMillis:300,data:function(e,t){var o;return o={t:d.template},e&&(o.x=e),t&&(o.p=t,o.c=t+1),o},results:function(e,t){var o,i;return o=function(){var t,o,i,n;if(null!==e.list){if(u.text)for(n=e.list,o=0,i=n.length;i>o;o++)t=n[o],t.text=t[u.text],delete t[u.text];return{results:e.list,more:e.query.c>e.query.p}}return{results:[]}}(),1===t&&angular.isDefined(u.first)&&(i={id:"",text:u.first},o.results?o.results.unshift(i):o.results=[i]),o}},angular.extend(u,d),f=!1,i(function(){return s.select2({ajax:u}),u.readonly&&s.select2("readonly",!0),f=!0,c.$render()}),s.change(function(){var e;e=s.select2("data"),c.$setViewValue(e.id?e:null),o.$apply()}),void(c.$render=function(){var e;return e=c.$viewValue,f?(angular.isObject(e)||(e=e?{id:e,text:""}:{id:"",text:u.first}),void s.select2("data",e)):void s.val(null)})):void n.error("Missing 'template' attribute"):void n.error("Missing 'type' attribute")}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.state",[]),e.directive("docflowState",["$docflowUtils","$docflowConfig",function(e,t){return{restrict:"A",require:"ngModel",scope:!0,link:function(o,i,n,r){r.$render=function(){var n,l,c,a;o.state&&(o.state.color&&i.removeClass("df-state-"+o.state.color),o.state=null),n=r.$viewValue,n?(l=e.splitFullId(n.id),a=t.docs[l.docType].states,o.state=c=a[n.state],i.text(c.title),c.color&&i.addClass("df-state-"+c.color)):i.text("")}}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.subtable",["docflow.config"]),e.directive("docflowHideValidation",[function(){return{scope:!0,restrict:"A",link:function(e,t,o){o.$observe("docflowHideValidation",function(t){e.hideValidation="true"===t})}}}]),e.directive("docflowWidgetSubtable",["$docflow","$http","$timeout","$log",function(e,t,o,i){return{scope:!0,restrict:"A",require:"ngModel",link:function(e,t,o,n){var r,l;return r={},e.sortableOptions={handle:".fa-ellipsis-v",axis:"y"},o.docflowWidgetSubtable&&angular.extend(r,e.$eval(o.docflowWidgetSubtable)),r.field?(l=angular.isDefined(o.required),void e.$parent.$watch("item._n."+r.field,function(t){var o,i,c,a,s,u;return"function"==typeof s&&s(),s=null,"function"==typeof u&&u(),u=null,t?(e.list=i=function(){var t,i,n,l;for(n=e.$parent.item[r.field],l=[],t=0,i=n.length;i>t;t++)o=n[t],l.push(o);return l}(),e.newline=a=angular.copy(t),i.push(a),s=e.$watch("newline",function(){a?a=null:(e.$parent.item[r.field].push(e.newline),e.newline=a=angular.copy(t),i.push(a))},!0),e.remove=function(t){var o,n;return t!==a?(n=e.$parent.item[r.field],o=n.indexOf(t),n.splice(o,1),i.splice(o,1)):void 0},c=function(t){e.list=i=function(){var e,i,n;for(n=[],e=0,i=t.length;i>e;e++)o=t[e],n.push(o);return n}(),i.push(e.newline),e.$parent.item[r.field]=t},void(u=e.$parent.$watch("item."+r.field,function(e){var t,o,r,a;if(l&&n.$setValidity("required",0!==e.length),e.length+1!==i.length)return void c(e);for(o=r=0,a=e.length;a>r;o=++r)if(t=e[o],t!==i[o])return void c(e)},!0))):void(e.list=e.$parent.item?e.item[r.field]:[])},!1)):void i.error("Missing 'field' attribute")}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.tags",["docflow.config"]),e.directive("docflowWidgetTags",["$docflow","$docflowConfig","$http","$timeout","$log",function(e,t,o,i,n){return{scope:!0,restrict:"A",require:"ngModel",link:function(o,r,l,c){var a,s,u,d,f;return d={},l.docflowWidgetTags&&angular.extend(d,o.$eval(l.docflowWidgetTags)),d.docType?d.template?(o.createNew=function(){e.dialogCreate(d.docType,"item","dict").then(function(e){e&&(c.$setViewValue(e),c.$render())})},a=r.find("[docflow-select2]"),s=a.length>0?$(a[0]):r,u={tags:null,ajax:{cache:!1,url:"/api/list/"+d.docType+"?&"+t.apiParams,dateType:"json",quiteMillis:300,data:function(e,t){var o;return o={t:d.template},e&&(o.x=e),t&&(o.p=t,o.c=t+1),o},results:function(e,t){var o,i;return o=function(){var t,o,i,n,r,l,c,a;if(e.list=e.list||[],o=e.list,u.text)for(r=0,c=o.length;c>r;r++)i=o[r],i.text=i[u.text],delete i[u.text];if(e.query.x){for(n=e.query.x.toUpperCase(),t=l=0,a=o.length;a>l&&(i=o[t],i.text.toUpperCase()!==n);t=++l);t===o.length&&o.unshift({id:"_"+n,text:e.query.x})}return{results:e.list,more:e.query.c>e.query.p}}(),1===t&&angular.isDefined(u.first)&&(i={id:"",text:u.first},o.results?o.results.unshift(i):o.results=[i]),o}}},angular.extend(u,d),f=!1,i(function(){return s.select2(u),f=!0,c.$render()}),s.change(function(){var e,t,i,n,r;for(i=s.select2("data"),t=[],n=0,r=i.length;r>n;n++)e=i[n],t.push("_"===e.id.substr(0,1)?{_u:{tag:{id:d.docType,title:e.text}}}:{_u:{tag:e.id}});c.$setViewValue(t),o.$apply()}),void(c.$render=function(){var e,t,o,i,r;if(o=c.$viewValue,f)if(o){if(!angular.isArray(o))return void n.error("Expected list of tags");for(e=[],i=0,r=o.length;r>i;i++)t=o[i],t.tag&&e.push(t.tag);s.select2("data",e)}else s.select2("data",null)})):void n.error("Missing 'template' attribute"):void n.error("Missing 'type' attribute")}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.textarea.size",["docflow.config"]),e.directive("docflowWidgetTextareaSize",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,i){i.$viewValue&&i.$formatters.push(function(e){var o,i;return o=e.length,i=o/23>8?8:Math.ceil(o/23+1),$(t[0]).attr("rows",i),e})}}}])}.call(this),function(){var e;e=angular.module("docflow.widget.texteditor",["docflow.config"]),e.directive("docflowWidgetTexteditor",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,i){var n;o.docflowWidgetTexteditor&&(n=e.$eval(o.docflowWidgetTexteditor)),t.redactor(angular.isDefined(n)&&"air"===n.mode?{air:!0,deniedTags:["html","head","link","body","meta","applet"],boldTag:"strong",italicTag:"i",changeCallback:function(){i.$setViewValue(t.html()),e.$$phase||e.$apply()}}:{minHeight:350,autoresize:!1,convertDivs:!1,removeEmptyTags:!1,cleanFontTag:!1,convertLinks:!1,imageUpload:"/uploadImage",uploadFields:{id:function(){return e.item.id}},deniedTags:["html","head","link","body","meta","applet"],boldTag:"strong",italicTag:"i",plugins:["fullscreen"],changeCallback:function(){i.$setViewValue(t.html()),e.$$phase||e.$apply()}}),i.$render=function(){t.html(i.$viewValue)},e.$on("$destroy",function(){var e;try{t.redactor("destroy")}catch(o){e=o}})}}}])}.call(this);